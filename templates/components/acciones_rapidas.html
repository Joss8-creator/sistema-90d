<!-- /sistema_90d/templates/components/acciones_rapidas.html -->

<div class="cuadrante cuadrante-acciones">
    <h2>‚ö° Acciones R√°pidas</h2>

    <!-- Siguiente Acci√≥n Sugerida -->
    <div class="accion-destacada accion-urgencia-{{ siguiente_accion.urgencia }}">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
            <h3 style="margin: 0; font-size: 16px;">{{ siguiente_accion.titulo }}</h3>
            {% if siguiente_accion.tiempo_estimado %}
            <span style="font-size: 12px; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px;">‚è±Ô∏è {{
                siguiente_accion.tiempo_estimado }}</span>
            {% endif %}
        </div>
        <p style="margin: 0 0 16px 0; font-size: 14px; color: #4a5568;">{{ siguiente_accion.descripcion }}</p>
        {% if siguiente_accion.accion %}
        <a href="{{ siguiente_accion.accion }}" class="btn"
            style="background: #2d3748; color: white; padding: 10px 16px; border-radius: 6px; text-decoration: none; display: inline-block; font-size: 14px; font-weight: 600;">
            Hacerlo ahora ‚Üí
        </a>
        {% endif %}
    </div>

    <!-- Cuadr√≠cula de botones -->
    <div class="acciones-grid">
        <button onclick="abrirModal('modal-nuevo-proyecto')" class="accion-btn">
            <span class="accion-icono">‚ûï</span>
            <span class="accion-texto">Nuevo Proyecto</span>
        </button>

        <button onclick="abrirModal('modal-nueva-metrica')" class="accion-btn">
            <span class="accion-icono">üí∞</span>
            <span class="accion-texto">Registrar M√©trica</span>
        </button>

        <button onclick="copiarPromptGlobal()" class="accion-btn">
            <span class="accion-icono">ü§ñ</span>
            <span class="accion-texto">Prompt de An√°lisis</span>
        </button>

        <!-- Nuevas Acciones con IA -->
        <a href="/ideas" class="accion-ideas accion-btn">
            <span class="accion-icono">üí°</span>
            <span class="accion-texto">Generar Ideas</span>
        </a>

        <button hx-post="/ia/analisis-automatico" hx-target="#modal-container" hx-indicator="#loading-analisis"
            class="accion-btn accion-ia" style="background: #e6fffa; border-color: #b2f5ea;"
            onclick="mostrarModalContainer()">
            <span class="accion-icono">ü§ñ</span>
            <span class="accion-texto">Analizar (Gemini)</span>
        </button>

        <a href="/exportar-csv" class="accion-btn">
            <span class="accion-icono">üìä</span>
            <span class="accion-texto">Exportar CSV</span>
        </a>

        <button onclick="ejecutarBackupManual()" class="accion-btn">
            <span class="accion-icono">üíæ</span>
            <span class="accion-texto">Crear Backup</span>
        </button>

        <a href="/health" target="_blank" class="accion-btn">
            <span class="accion-icono">üîç</span>
            <span class="accion-texto">Estado Salud</span>
        </a>
    </div>
</div>

<script>
    function abrirModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'flex';
            // Prevenir scroll del body cuando el modal est√° abierto
            document.body.style.overflow = 'hidden';
        }
    }

    function cerrarModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
            // Restaurar scroll del body
            document.body.style.overflow = 'auto';
        }
    }

    function copiarPromptGlobal() {
        // Abrir el modal de IA que ya existe o mostrar un alert
        window.location.href = '/exportar-prompt';
    }

    function ejecutarBackupManual() {
        alert('Iniciando backup manual...');
        // Aqu√≠ se podr√≠a hacer un fetch a una ruta de backup
    }

    function mostrarModalContainer() {
        const container = document.getElementById('modal-container');
        if (container) {
            container.style.display = 'flex';
            container.innerHTML = '<div class="spinner"></div><p style="color:white;text-align:center;width:100%;">Analizando con Gemini...</p>';
        }
    }

    // Cerrar modal con tecla ESC
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            const modales = document.querySelectorAll('.modal');
            modales.forEach(modal => {
                if (modal.style.display === 'flex') {
                    cerrarModal(modal.id);
                }
            });
            const container = document.getElementById('modal-container');
            if (container && container.style.display === 'flex') {
                container.style.display = 'none';
            }
        }
    });
</script>